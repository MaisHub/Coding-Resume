---
title: "Predict Future Sales"
author: "Sharon"
date: "9/21/2019"
output: html_document
---
You are provided with daily historical sales data. The task is to forecast the total amount of products sold in every shop for the test set. Note that the list of shops and products slightly changes every month. Creating a robust model that can handle such situations is part of the challenge.

File descriptions
sales_train.csv - the training set. Daily historical data from January 2013 to October 2015.
test.csv - the test set. You need to forecast the sales for these shops and products for November 2015.
sample_submission.csv - a sample submission file in the correct format.
items.csv - supplemental information about the items/products.
item_categories.csv  - supplemental information about the items categories.
shops.csv- supplemental information about the shops.

Data fields
ID - an Id that represents a (Shop, Item) tuple within the test set
shop_id - unique identifier of a shop
item_id - unique identifier of a product
item_category_id - unique identifier of item category
item_cnt_day - number of products sold. You are predicting a monthly amount of this measure
item_price - current price of an item
date - date in format dd/mm/yyyy
date_block_num - a consecutive month number, used for convenience. January 2013 is 0, February 2013 is 1,..., October 2015 is 33
item_name - name of item
shop_name - name of shop
item_category_name - name of item category
```{r echo=TRUE}
###Packages
library(dplyr) 
library(ggplot2)
library(RColorBrewer)
```

```{r echo=TRUE}
###Import data
item_cate <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/item_categories.csv", stringsAsFactors=FALSE)
item <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/items.csv", stringsAsFactors=FALSE)
sales <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/sales_train.csv.gz", stringsAsFactors=FALSE)
sub <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/sample_submission.csv.gz", stringsAsFactors=FALSE)
shops <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/shops.csv", stringsAsFactors=FALSE)
test <- read.csv("~/Documents/GitHub/Coding-Resume/competitive-data-science-predict-future-sales/test.csv.gz", stringsAsFactors=FALSE)

```

```{r echo=TRUE}
###Basic Exploration
head(sales)
head(item) 
head(item_cate)
head(shops)
``` 

```{r echo=TRUE}
##Shop
nrow(shops)
``` 

```{r echo=TRUE}
##Item
nrow(item_cate)
nrow(item)
``` 
Aggregate by monthly level
aggregate by date_block_num, shop_id, item_id
summarise min/max on the date, average of the item_price, sum of the sales
```{r echo=TRUE}
##Training data
sales <- left_join(sales,item,by="item_id")
sales <- left_join(sales,item_cate,by="item_category_id")

sales1 <- sales %>%
          group_by(date_block_num,shop_id,item_id) %>%
          summarise(date_max=max(date),date_min=min(date),price_mean=mean(item_price),item_cnt_day_count=sum(item_cnt_day))
sales1
``` 

```{r echo=TRUE}
#data
d_chart1 <- select(sales, item_category_id,item_cnt_day) %>%
            group_by(item_category_id) %>%
            summarise(item_cnt_day_count=sum(item_cnt_day))
d_chart1 <- top_n(d_chart1,9,item_cnt_day_count)
d_chart1$item_category_id <- as.character(d_chart1$item_category_id)

#chart1
c1 <- ggplot(d_chart1, aes(item_category_id,item_cnt_day_count))+
      geom_bar(stat = "identity",aes(fill=item_category_id))+
      scale_fill_brewer(palette = "Blues",name="Item Category")+
      scale_y_continuous(labels = function(x) format(x, big.mark = ",",scientific = FALSE))+
      ggtitle("Amount of Item per Category")+
      xlab("Item Category")+
      ylab("Amount of Item")+
      theme_minimal()
c1
``` 

```{r echo=TRUE}
#data
d_chart2 <- select(sales, shop_id,item_cnt_day) %>%
            group_by(shop_id) %>%
            summarise(item_cnt_day_count=sum(item_cnt_day))
d_chart2 <- top_n(d_chart2,9,item_cnt_day_count)
d_chart2$shop_id <- as.character(d_chart2$shop_id)

#chart2
c2 <- ggplot(d_chart2, aes(shop_id,item_cnt_day_count))+
      geom_bar(stat = "identity",aes(fill=shop_id))+
      scale_fill_brewer(palette = "Blues",name="Shop ID")+
      scale_y_continuous(labels = function(x) format(x, big.mark = ",",scientific = FALSE))+
      ggtitle("Amount of Item per Shop")+
      xlab("Shop ID")+
      ylab("Amount of Item")+
      theme_minimal()
c2
```
